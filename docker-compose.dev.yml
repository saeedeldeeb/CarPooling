services:
  # ── Infrastructure overrides for container networking ───────────

  kafka:
    environment:
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092

  # ── Application Services (dev with hot reload) ─────────────────

  config-server:
    container_name: cp_config-server
    build:
      context: .
      dockerfile: Dockerfile.dev
      args:
        SERVICE_NAME: config-server
    ports:
      - "8888:8888"
    volumes:
      - ./services/config-server/src:/app/src
      - maven-cache:/root/.m2
    networks:
      - microservices-net
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8888/actuator/health"]
      interval: 10s
      timeout: 5s
      start_period: 30s
      retries: 10

  discovery:
    container_name: cp_discovery
    build:
      context: .
      dockerfile: Dockerfile.dev
      args:
        SERVICE_NAME: discovery
    ports:
      - "8761:8761"
    volumes:
      - ./services/discovery/src:/app/src
      - maven-cache:/root/.m2
    environment:
      SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
      EUREKA_INSTANCE_HOSTNAME: discovery
    networks:
      - microservices-net
    depends_on:
      config-server:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8761/actuator/health"]
      interval: 10s
      timeout: 5s
      start_period: 30s
      retries: 10

  # gateway:
  #   container_name: cp_gateway
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.dev
  #     args:
  #       SERVICE_NAME: gateway
  #   ports:
  #     - "8222:8222"
  #   volumes:
  #     - ./services/gateway/src:/app/src
  #     - maven-cache:/root/.m2
  #   environment:
  #     SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://discovery:8761/eureka/
  #   networks:
  #     - microservices-net
  #   depends_on:
  #     discovery:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:8222/actuator/health"]
  #     interval: 10s
  #     timeout: 5s
  #     start_period: 30s
  #     retries: 10

  # ride:
  #   container_name: cp_ride
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.dev
  #     args:
  #       SERVICE_NAME: ride
  #   volumes:
  #     - ./services/ride/src:/app/src
  #     - maven-cache:/root/.m2
  #   environment:
  #     SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://discovery:8761/eureka/
  #   networks:
  #     - microservices-net
  #   depends_on:
  #     discovery:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/actuator/health"]
  #     interval: 10s
  #     timeout: 5s
  #     start_period: 30s
  #     retries: 10

  # booking:
  #   container_name: cp_booking
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.dev
  #     args:
  #       SERVICE_NAME: booking
  #   volumes:
  #     - ./services/booking/src:/app/src
  #     - maven-cache:/root/.m2
  #   environment:
  #     SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://discovery:8761/eureka/
  #   networks:
  #     - microservices-net
  #   depends_on:
  #     discovery:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/actuator/health"]
  #     interval: 10s
  #     timeout: 5s
  #     start_period: 30s
  #     retries: 10

  # payment:
  #   container_name: cp_payment
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.dev
  #     args:
  #       SERVICE_NAME: payment
  #   volumes:
  #     - ./services/payment/src:/app/src
  #     - maven-cache:/root/.m2
  #   environment:
  #     SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://discovery:8761/eureka/
  #   networks:
  #     - microservices-net
  #   depends_on:
  #     discovery:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/actuator/health"]
  #     interval: 10s
  #     timeout: 5s
  #     start_period: 30s
  #     retries: 10

  # rating:
  #   container_name: cp_rating
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.dev
  #     args:
  #       SERVICE_NAME: rating
  #   volumes:
  #     - ./services/rating/src:/app/src
  #     - maven-cache:/root/.m2
  #   environment:
  #     SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://discovery:8761/eureka/
  #   networks:
  #     - microservices-net
  #   depends_on:
  #     discovery:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/actuator/health"]
  #     interval: 10s
  #     timeout: 5s
  #     start_period: 30s
  #     retries: 10

  # notification:
  #   container_name: cp_notification
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.dev
  #     args:
  #       SERVICE_NAME: notification
  #   volumes:
  #     - ./services/notification/src:/app/src
  #     - maven-cache:/root/.m2
  #   environment:
  #     SPRING_CONFIG_IMPORT: optional:configserver:http://config-server:8888
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://discovery:8761/eureka/
  #   networks:
  #     - microservices-net
  #   depends_on:
  #     discovery:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/actuator/health"]
  #     interval: 10s
  #     timeout: 5s
  #     start_period: 30s
  #     retries: 10

volumes:
  maven-cache:
